trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

variables:
 - group: dockerhub

steps:
  - script: |
      java --version
    displayName: 'Checking Java Version'
  - script: |
      ./gradlew clean compileTest
    displayName: 'Compile files'
  - script: |
      ./gradlew test -x compileTest
    displayName: 'Run tests'
  - script: |
      ./gradlew build -x test
    displayName: 'Create jar'
  - script: |  
      docker build --tag lecsobkw/simplejavaapp:1.0 .
      docker images
    displayName: 'Build docker image'
  - script: |
      docker login -u $(username) -p $(password) 
      docker push lecsobkw/simplejavaapp:1.0
    displayName: 'Push docker image'
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))
